from enum import Enum


class SessionInstance:
    __instance = None
    certificate = bytes.fromhex("308205f130820459a003020102020900cb2d80995a69525c300d06092a864886f70d01010b0500304d310b300906035504061302585931263024060355040a0c1d507974686f6e20536f66747761726520466f756e646174696f6e2043413116301406035504030c0d6f75722d63612d736572766572301e170d3138303832393134323331365a170d3238303730373134323331365a305f310b30090603550406130258593117301506035504070c0e436173746c6520416e746872617831233021060355040a0c1a507974686f6e20536f66747761726520466f756e646174696f6e3112301006035504030c096c6f63616c686f7374308201a2300d06092a864886f70d01010105000382018f003082018a02820181009f282f3741ef7f6463166216e901146229ca3a98923d08d35e69fec0f3d4c4fb0e58dc64b04bcbb3aa9e42e9079b6733cdb9e83c1d8a13c0df39677c4cd37ebf430f4a85056d87e5c302a33ed7d7b9287918731837777648d47818d7bd1e6a468b06f30337950ba053b022cd8fb70336a3d72377999f4ae5adb48ebe7c2aa8a7cfe5f1c7ab1bd897d861f7f69de25b05a84d9b989dd000f6a62fd3b6166a3b90d4449628f8c76064e732fbb8c48ce26c2d665ddd8ceaefc88cd3ba838dba48a15a443590931d3580857f0b22acf43819a1e30790a66e3ea6553b138af80fcdae6aea1c5b0f22caece7093b400563bb9fd7d6c9299ff50642598c47005a4142ceb3515a800fb9e115d4eaa50f5b4626849e31381e201c70f5be300a12c459effeb37313323a6f8cd436ca4531f83568d55a99d8f1769519d461b53a47f4c8f27292a117e0f665dcb6b505edaaed8675c32751e76dd777e7f710ee3f83e8a611348a9fc83209fe91be26f5ef92f8af6595d425d01fb805c19602a1de961d8ab94d0203010001a38201c0308201bc30140603551d11040d300b82096c6f63616c686f7374300e0603551d0f0101ff0404030205a0301d0603551d250416301406082b0601050507030106082b06010505070302300c0603551d130101ff04023000301d0603551d0e041604148fea1de3335c0016b38b6f6b6fd34ccbb5cb7c55307d0603551d23047630748014ddbfcadae6d134ba377521ca6f9a0828f235b648a151a44f304d310b300906035504061302585931263024060355040a0c1d507974686f6e20536f66747761726520466f756e646174696f6e2043413116301406035504030c0d6f75722d63612d736572766572820900cb2d80995a69525b30818306082b0601050507010104773075303c06082b060105050730028630687474703a2f2f7465737463612e707974686f6e746573742e6e65742f7465737463612f70796361636572742e636572303506082b060105050730018629687474703a2f2f7465737463612e707974686f6e746573742e6e65742f7465737463612f6f6373702f30430603551d1f043c303a3038a036a0348632687474703a2f2f7465737463612e707974686f6e746573742e6e65742f7465737463612f7265766f636174696f6e2e63726c300d06092a864886f70d01010b0500038201810027f58c5910f4c6e72800bfba8d7b1303f11ca65fb30655a422b9dbb2d546bdf70cdd436eb4796567210c2a55ee408e859f9f47bb0a2a4db6647498a07faedcf12edb427718e0758b263568c341ed6bc877726f6a9a5d556902fd5a54c857cbb0650316e20f00399966a09b889317e25a2d79355f975778c4aff5995e86abd311ad1aa20dfa5210b9febf9dce33d986b29c16f8d675088adb0ae5b42b167fb4f92a9fc3d277d7cd651ef46c1eeb59b9f0ae5fa41fcc4ac4b97aa9d96b32683be165b084b790c4aefef4374f21a0de9f3ab1e5cc1604663f0b41dc423d203eecb7952b3557fabe7fb63abaca4f58fe753e08892c8cb05d2ef989102bf941464f3c00b727d36524281723263142ea7e4e93e47b6854ca9f46f3ef2be9850cb584b2d5353480752bf09123b808018eb90a54d4fb3452fed945f0803bb6c16f82d11ff23b08f646a69627614b58327a0e1d59c544ad5e1a7933c1d4052f4ad3d842428d33e363cad587979b4db81a0334bb1cd2023f5923e223808863c2f0a263a88b")
    certificate_private_key = bytes.fromhex("308204a40201000282010100c9b3")
    total_handshakepacket = 0
    connection_id = -1
    initial_source_connection_id = "" 
    initial_destination_connection_id = ""
    server_config_id = ""
    source_address_token = ""
    public_value = None # object
    public_values_bytes = ""
    private_value = None
    client_initial_destination_connection_id = ""
    shared_key = b''
    _ec_private_key = ""
    _x25519_private_key = ""
    _x448_private_key = ""
    configuration = None
    chlo = ""
    shlo = ""
    tlschlo= b''
    tlsshalo= b''
    crypto_extensions = b''
    crypto_cert = b''
    crypto_certverify =b''
    crypto_finished =b''
    server_handshake_secret = b''
    client_handshake_secret = b''
    client_handshake_traffic_secret= b''
    server_handshake_traffic_secret= b''
    client_appliction_traffic_secret= b''
    server_appliction_traffic_secret= b''
    handshake_done = False
    randome_value = b''
    
    dummy_packet_handshake = "e600000001083fe9e834d5a6a9e008597472b5b2be72a343c277e0b2dda2d16cdcee580cc958412ec819483d0d734b677e97c11325904e3b524b3960c462e4fb11a55059ed569e351069a4d2a044490e402107409c294b5595f58a0a67d9c7a758db9e8e6ee2b936961958a7d5123a7f9660346e7347998764fdbbc2cbe07d8f22a67bd74465f62dea3a494289568a93bc9a3fc3aac0f8a9824ea8960688bfdef49f7b48ef6dbf8761cbe9e259ba36819edad39fb3ea2b1f66a66e5bad72f0e18fa941ecf7b4e1584834de672b4f1056fb76289d940b4e85ecca034946012abec01f9882f5bdd79257bfccdcddc07b8da158ec4fc63ce42ab1845cfae47535aecca90524c8c15c2ed53c4de47c9b4b6b74fb3f08b2e541ccfdd8c7a3200d46841bb427423d8849ad27679920fb2f1213357fb0ae155ebd8974280ece655fb73ea59ba92178e2c1b58dbd9573ad1a73523de7c4ec625ef76dd0feeadc8d0b3587a54a22cb512464f28c27ce3ca1f9870b4d92f2a7ac753ba6fc9e245773bf6a912807330e528c3982b8adcfd2b9156dacf2797140f044de2e773107758a87839f9855e3a9eeadf7a9380225c9b0b1f08f23b93d794d67521a12bb36bd1e8da97a8f333c3a1b636ccba0eb6c1746a97d538e44ae4b89720d85c40ecf72a35ac8dd8bdc5251975cd9476dc4625e620475ef9f426d0ecd84e3ad214348e1c3e2726bda0bae7a027350e76a35b547bf19dc3b0e3817a8709c9633d7a07a5ffa4d0c2ef25307445db090b432723077f25efe39db25b224a2571e530d183c6e21bbdc52f957f336d5a463c4b722a9c47b108d13fd0d8c728d6fe5019f557a7b69330d09d5e21ea86f0a094e6babb67e8400aca5663050897fbd823134b941aced0ef211d3e22871dbacb98ed6ea6a38227824480d1855d8daa3e915f6fad8114f214a1e82d3bec2a8abaf7005340d971442b3724fcb64ad40b3833552f68448e328c0d6a746ec214525e5bc0236dc15ffa9d1b739cadcebdbb6570c584083dba46b35dd02c3216e61c2f8e10040ba2c4333e4368c54a9acb82e72e428a4835f1c6806c07aa732a049ced81e8ce27de7984ded157540a656a318684f75ecd64fd881b1d5378c451038c25efb95b82b0b077c36aa38b56e6a2dcf2a5933d5897450c75a69490cdc889e77b3936339e5e9d65d7c6e5c5cc2942272febf11d5a377528049fbffe5a2ca3c4208b15636a6681146cf1e0627532e707f3897992de67ffa066293d4a1528d5b49f58aab5340020bb679e1c7325e50be5a5abe2b166d361d6af3632ecfc973097435eae8baba1f0929a9907625e426f9bf653dfe4b766b7a4e9d115d7f7feb905dd368b851b9ea04fa96d99863d72ab826e1231c92194385545df0a0019d21dd354ade68e8abc79d9644e9c809076b3165b7813d5558b5593f773684c0ecca393b63c5f289acd44e63208c43d150ff284af15827bd1bc847835ebdc91bf57d2468f57d371ce5a4a11880549187f228cd5872436cc49abfa47c3a10313844ec2018a2199f9b3e78e6366b49e0f86a69105e361bd1942cbf243353f7e498a7a2ba97fed424f3db6d09433f607e108af9387aee"
    dummy_packet_serverhello = "c900000001083fe9e834d5a6a9e008597472b5b2be72a30044962fc020e51331ad22e1140fc625429acac8abd1e96c305b76c8b4138a172ac5763708161b1844dcfb75e44bd1229163b120c0165b948e82c5c2dedecdd308f8ee3e1e674fec9dad65d664f2f79d6f41929fea6c4ad51b104d2b42b776b732a6f20a7b11f2a32fef43fa0a98dfb4d2ec3933183b9429fa3dd3b84a79747aa3d32078b9c19763a359945e3632a9291f53f8e9c3f50bfee11314f1862ee34627972ceadc6a5e59e20ac86cc5182f13ffa0c57585b6dae4e3162fc6c402065bd49dae145462f39bcb7c058e99b64a1ab2f284d5c774cd2efb1b3fa21118607dd9d019747d7b1054c90c5830f9b717f4aeb09bab7b2d55c63831524546ca544b0fceeb82b30499cc291b11448ad94bac70540f0d7a8171cbb6d43a8628d8c8cfe190bf085354d116b04550e943835f96ac2126fd0ae4cef929f6a20836006caed385b75422491a2a76668cb7ae57c0fa93776591214d606d62ef2a27cd1b57cef7620660e67a150b44860c0c3686a411ffdaf2637bf3c1dbb05b2ccf31578a2a7374cebfaabe99e50369d530b03217e9b939d63867054d027b897abe32275acad856a66ae7df30c006165e6c5937a865ac6c88e9bb81e9190f73f71536aa1c56764c5b0c87ae8a825b508523f90024cb6891f0a1f65f0954000fe9bdcd2e2b86dc130d7f6d1c9397411d3ea587cd53d51422fd363ee0ca0a87408bc98e4039f1f00d672aca8fad4aaf93104234ee513e906d4635cf28c8df52418628616f3e18156ff2c7d9cf6afe23143dca11d0401fbb76bcf23516e38aafaa2d422d738cb37087708685e1b1739bf32022a646af9b136c20594a904df3ba8e8a6c28579c3ddc00244738fc4f707091b5713c3ece8e8c3c1001d1ab4a4c26cb0d7fb01a09c5cb21a8dd7b1d79c36b126fb159fe71c1167f41e312a7189bb364785c49f08109b469c6bff2bf0bf049d64550ae5a64d6498855f41ee106fe2d8fc39d6f6ebe1e4d44f9f51dd294448264894458e3628d666b2bc68f4780834d20f046091e3853afd480e372ad8aa92ee923e5d95ee7c2e77b43adaeb8df897f291578d0431556789127356fbd242798bda7240ed24daf933888335c0bfcbcb4f4a309cb1bdead082b0e2ff4a87f9ab326aad606d3f7f199f246105045a43a644317f4b9c8221b3f83a3f32764c606c031065ce28cef91e22409a87d13cd68381e4b8b3fee3b6c1764555d73a9cc949ce23bde6fdec35106e5b8bd96181c5f19ba12a6769408cddfb701be9d81e6d2e366831c024a647f335d795cb4a8977119652c0bc444c0d76477ded60533c5f522d6b5b88942ef62b2aad7ea93a01254328154bd0b34b4c4ec39088cb5ebac198ad66d71805b835ec45a423a11df84455d4aef72ff6e73a05683e4698369f42017dfe0cdf9d02e21b17dee58d70e801e9c9820e81b20c357b05cac5e05668db229b35f644260092e8e5aadbbb5a8570a91a804667c05094ae930814645dc6747a10a7d1b978d61c1353858e1ace919f80403df8bf2de2b6504dbf6cbac60e72672ad3b538b5c2a6ed96aecfde4344e4c6528051103b9f4ac34944c3ccdfdc0a06f11e5b75df52b34cf8c8ea1317306a568c1dd846e68a8d22db03eb7f799389ae36ccfaf403b6a67e0554a39310f46748b"
    dummy_packet_handshake_done = "723fe9e834d5a6a9e0d4135271cc891fab1cdd58dd4e41effece9054c14cd431a997cc1e9eb26e2054fa3b8267a9cf6fb1b45793d8cab84816f58381120e4931e2446e4d879b8148db33de6711e75b06ce67b5cb5451887b326e1ddd605557c4b01742e5ed7efbe2fcb98d578444650b942207dccb1b87f6f8d65d2faf6d387dfd3616d1a65402917a0b917cc643e76ea286d6e33bbe57d8ad300b7b6eedd5b0440b68c9ef64ec15365b4450da6726f6349da4dcfc3e34b86e73160e1d3a5702c76d1a62195b78376e535496029bcbfe63a436436b35ae8a840b613364c042bd4f24520abcc2e6f1"
    dummy_packet_http = "663fe9e834d5a6a9e0949b91c6d8b99b9b2ef7c6a34cb38b4a4e4415505fd1ce6b5e93cdb861212adbdc04235a92a85c79ebdc1006e04dcba93c4bbc83b2fcb70407e943900f39637f167620992334f92fe9697c2ae0d8200ad065db0c643a4621db61e06efafd94ccd9f63ceaae85aa3d56bd141d5067501ab12be57498f5ad837c6a44dfbe39a2ab0463aee54bb5cc6e5de51ecce3b0bdad425779accefe68e7bc18e07e5d2f829d2f58af1fbd1fddf19c322f03d73acde45d5111023721d133a48bed662f6610441f60fdc34b528ed199940a1ad9e3356dc44065a8016f04692e904ca87708ebf67d0e4cbd648b1a74a04d6e3804f45f2c0866743850b268978afa2fd7158e5d20a89849253ce30dae74833b43cd14d740997a9a8a630fbb626b176515e361ee7d0f7ea6113a31d474f65ef8b6d06ee78f067c1659cdf5d47f88432c52c28412b3e71615ef2552c8cb9ede5ce48b932ce4aa9530e81a28096778d68c2e4b232aaa99ffb2b9750ac84a90a377782092e8d6f9c00139a64d1a7dac756c2e141c634fd0b1be3e8d775cca587a1564b85b0683cdc6fff6e1f360fa4f1c6c05ca3c3fa6b5566a7897c75fe5fe22e54f41dbb6dee12cacd7cb3bf45c7e9c83122cb7d8cd8796a2a77997d0c68e0701533403da2b18d54b6b0752d31d1d7749cf02effb5d2d77576ae2177eeb6eee9c90f155b0b77369099b6cdef23b784d867f133b9d2a593476639bf9f60a621081023dab1bb93103f7df8e08a978a0a1f5b46f322c17ab130be3680a15e0187c6aa0c35513964b5c71f6ddfe8fb2a35971d47a9545aa372936eebe9bba5254ed0d4cafb4d79d54079c5aea1151ba168a1cb4e7e902c0d3d2685bd7f8b96998e271d19eec1a26bed6119874fdd0d05f34ae9435ff63b5b625e56489704eda5bb71912d7d0cb235596a52256f79488293fb0ba223b4eeb49122baecbb6fe60db3afee189be4d0397c96d4a469202b214692155cb03b6466e37f467b48fd824f15b38aad4e00f4a8c3c06f9ecc949846e0bf9e4ad91716d065a946879abf4b53b8c8cc9ef73b40362e1af80619837d018fb03d435259b3f00069f5dd29b3971f5e3c0d7bf7eb5c3351fa8983f63587b1d5f4d7c8f8e54511d8b882075cf614a1b30b9100d42c98e82579f0c13bd6f57bb21cc3ff4f04cd34f1ade82d15d0e069482b1b03bc6fedd84b896e90f271ad6b12ccbd68050b60cba76982ad79d4de21b5374d441d0e98b3bd761e62448e20a4802f5855d19f24491da11b2adddaa4e76e96c95eb138a179c7b5cba9930ff762accf5772875c09ad6dacd9cde1b4bf13a885bf7ed0a4dad106638785c8c6467fb596c4a6d466232df245c90ad642eab20805142bdab42d9804fba8745da7fa2f9c80e47c21d8e6e514ea6cdd411b7e058fb8756ae7ce5fc17a2160c6baee89fe67d42a4cc87277fe223d86ee23a6ed1a318e363ecdad0dad658d781eabcaf8bb95400f9f263eb7176f65aebf57e8389c493c0a9a6df75c8cac63298f2fbd5365878e49912378458a87aca73bffe3e5333863d58a22b939fcaa9f618ec673f9b097d51c34a54a61cdcd0f4b372b563528b2eed9990efb03ff1933802ba2adfe2c88d841ad0bcffebdb294dfaf0204d786532c0d0870ffe24e684f85ec971d19fd4647609e6e2fd5b38445ba05d01bb"
    scfg = ""
    cert_chain = ""
    cert_localhost = ""

    initial_keys = {}
    final_keys = {}
    peer_public_value_initial = ""
    peer_public_value_final = ""
    div_nonce = ""
    message_authentication_hash = ""
    associated_data = ""
    packet_number = ""
    largest_observed_packet_number = -1
    shlo_received = False
    nr_ack_send = 0
    connection_id_as_number = -1
    destination_ip = "127.0.0.1"  # Home connectiopns
    # destination_ip = "192.168.43.228"   # hotspot connections
    zero_rtt = False
    last_received_rej = ""  # We are only interested in the last REJ for the initial keys.
    last_received_shlo = ""
    app_keys = {'type': None, 'mah': "", 'key': {}}
    first_packet_of_new_command = False
    currently_sending_zero_rtt = False  # If it is set to True, then we do not need to store the REJ otherwise it will not work.

    @staticmethod
    def get_instance():
        if SessionInstance.__instance is None:
            return SessionInstance()
        else:
            return SessionInstance.__instance

    def __init__(self):
        if SessionInstance.__instance is not None:
            raise Exception("Singleton bla")
        else:
            self.server_config_id = "-1"
            self.source_address_token = "-1"
            SessionInstance.__instance = self

    @staticmethod
    def reset():  
        SessionInstance.__instance = None      

